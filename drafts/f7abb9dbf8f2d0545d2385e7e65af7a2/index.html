
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Eleventy v3.1.2">
    <meta name="description" content="true">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet">
    <title>Ryan Martin | Advent of Code 2024 in Zig</title>
    <script src="/js/script.js" defer=""></script>
  <style id="MJX-SVG-styles">
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}
</style></head>
  <body>
    <a href="#main" id="skip-link">Skip to main content</a>
    <header>
      <a href="/">ryanmartin.me</a>
      <nav>
            <a href="/articles/">Articles</a>
          
            <a href="/snippets/">Snippets</a>
          
            <a href="/tags/">Tags</a>
          
            <a href="/projects/">Projects</a>
          
            <a href="/">About</a>
          </nav>
    </header>
    <div id="top"></div>
    <main id="main">
      
      
<article>
  <header>
    
      <p id="draft">DRAFT</p>
    
    <h1>Advent of Code 2024 in Zig</h1>
    <p> <!-- wrap with p just to make the line height consistent -->
      <time>03 August 2025</time>
    </p>
    <ul class="tags"><li><a href="/tags/#advent-of-code">#advent-of-code</a></li><li><a href="/tags/#algorithms">#algorithms</a></li><li><a href="/tags/#optimization">#optimization</a></li><li><a href="/tags/#zig">#zig</a></li></ul>
  </header>
  <section id="content">
    <p>This post is about <s>five</s> six months late, but here are my takeaways from <a href="https://adventofcode.com/">Advent of Code 2024</a>. It was my second time participating, and this time I actually managed to complete it.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> My goal in participating was to learn a new language, <a href="https://ziglang.org/">Zig</a>, and to improve my DSA and problem solving skills.</p>
<p>In case you’re not familiar, Advent of Code is an annual programming challenge that runs every December. A new puzzle is released every day from December 1st to the 25th. There’s also a global leaderboard where people (and AI) race to get the fastest solves, but I personally don’t compete in it.</p>
<p>I went with Zig because I have been curious about it for a while, mainly because of its promise of <a href="https://www.youtube.com/watch?v=Gv2I7qTux7g">being a better C</a> and because <a href="https://tigerbeetle.com/">TigerBeetle</a> is written in it. Learning Zig seems like a good way to get back into systems programming, something I’ve been wanting to do after a couple chaotic years of web development.</p>
<p>This post is mostly about my setup, results, and the things I learned from doing the puzzles. If you’re more interested in my solutions, I’ve also uploaded my code and solution write-ups to my <a href="https://github.com/rmrt1n/advent-of-code">GitHub repository</a>.</p>
<p><img loading="lazy" decoding="async" src="/drafts/f7abb9dbf8f2d0545d2385e7e65af7a2/FBG5iC0aoh-1394.webp" alt="My Advent of Code page" width="1394" height="1228"></p>
<aside class="toc"><div>
      <h2 id="toc"><a href="#toc" class="header-anchor">Table of Contents</a></h2><ol><li><a href="#project-setup">Project Setup</a></li><li><a href="#self-imposed-constraints">Self-Imposed Constraints</a></li><li><a href="#favourite-puzzles">Favourite Puzzles</a></li><li><a href="#programming-patterns-and-zig-tricks">Programming patterns and Zig Tricks</a><ol><li><a href="#leverage-comptime">Leverage Comptime</a></li><li><a href="#use-optional-types">Use Optional Types</a></li><li><a href="#pad-your-2d-grids">Pad Your 2D Grids</a></li><li><a href="#use-vectors-and-simd">Use Vectors and SIMD</a></li></ol></li><li><a href="#performance-tips">Performance Tips</a><ol><li><a href="#minimise-allocations">Minimise Allocations</a></li><li><a href="#compact-your-data">Compact Your Data</a></li><li><a href="#reduce-branching">Reduce Branching</a></li><li><a href="#avoid-recursion">Avoid Recursion</a></li></ol></li><li><a href="#benchmarks">Benchmarks</a></li><li><a href="#reflections">Reflections</a></li><li><a href="#what%E2%80%99s-next%3F">What’s Next?</a></li></ol></div></aside>
<h2 id="project-setup" tabindex="-1"><a class="header-anchor" href="#project-setup">Project Setup</a></h2>
<p>There were <a href="https://github.com/search?q=advent+of+code+template+lang%3Azig&amp;type=repositories">several project templates in Zig</a> that I looked at as a reference for my development setup. None of them really clicked for me, so for the duration of the event I just ran my solution code directly using <code>zig run</code>. It was until after the event was over that I properly learned <a href="https://ziglang.org/learn/build-system/">Zig’s build system</a> and reorganised my project.</p>
<p>Here’s what the current project structure looks like:</p>
<pre class="language-plaintext"><code class="language-plaintext">.
├── src
│   ├── days
│   │   ├── data
│   │   │   ├── day01.txt
│   │   │   ├── day02.txt
│   │   │   └── ...
│   │   ├── day01.zig
│   │   ├── day02.zig
│   │   └── ...
│   ├── bench.zig
│   └── run.zig
└── build.zig</code></pre>
<p>The project is powered by <code>build.zig</code> which defines several commands:</p>
<ol>
<li><strong>Build</strong>
<ul>
<li><code>zig build</code> - Builds all of the binaries for all optimisation modes.</li>
</ul>
</li>
<li><strong>Run</strong>
<ul>
<li><code>zig build run</code> - Runs all solutions sequentially.</li>
<li><code>zig build run -Day=XX</code> - Runs the solution of the specified day only.</li>
</ul>
</li>
<li><strong>Benchmark</strong>
<ul>
<li><code>zig build bench</code> - Runs all benchmarks sequentially.</li>
<li><code>zig build bench -Day=XX</code> - Runs the benchmark of the specified day only.</li>
</ul>
</li>
<li><strong>Test</strong>
<ul>
<li><code>zig build test</code> - Runs all tests sequentially.</li>
<li><code>zig build test -Day=XX</code> - Runs the tests of the specified day only.</li>
</ul>
</li>
</ol>
<p>You can also pass the optimisation mode that you want to any of the commands above with the <code>-Doptimize</code> flag.</p>
<p>Under the hood <code>build.zig</code> compiles <code>src/run.zig</code> when you call <code>zig build run</code>, and <code>src/bench.zig</code> when you call <code>zig build bench</code>. These files are templates that import the solution for a specific day from <code>src/days/dayXX.zig</code>. For example, here’s what <code>src/run.zig</code> looks like:</p>
<div class="codeblock">
      <div>
        <span>src/run.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> puzzle <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"day"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Injected by build.zig</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arena <span class="token operator">=</span> std<span class="token punctuation">.</span>heap<span class="token punctuation">.</span>ArenaAllocator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>heap<span class="token punctuation">.</span>page_allocator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">defer</span> arena<span class="token punctuation">.</span><span class="token function">deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> allocator <span class="token operator">=</span> arena<span class="token punctuation">.</span><span class="token function">allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"{s}\n"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>puzzle<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _ <span class="token operator">=</span> <span class="token keyword">try</span> puzzle<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>allocator<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token punctuation">.</span>debug<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>The <code>day</code> module imported is an <a href="https://ziglang.org/learn/build-system/#generating-zig">anonymous import</a> dynamically injected by <code>build.zig</code> during compilation. This allows a single <code>run.zig</code> or <code>bench.zig</code> to be reused for all solutions. This avoids repeating boilerplate code in the solution files. Here’s a simplified version of my <code>build.zig</code> file that shows how this works:</p>
<div class="codeblock">
      <div>
        <span>build.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> std <span class="token operator">=</span> <span class="token builtin">@import</span><span class="token punctuation">(</span><span class="token string">"std"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">build</span><span class="token punctuation">(</span>b<span class="token punctuation">:</span> <span class="token class-name"><span class="token operator">*</span>std<span class="token punctuation">.</span>Build</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">void</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">standardTargetOptions</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> optimize <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">standardOptimizeOption</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> run_all <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token string">"Run all days"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> day_option <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token builtin-type keyword">usize</span><span class="token punctuation">,</span> <span class="token string">"ay"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The `-Day` option</span>

    <span class="token comment">// Generate build targets for all 25 days.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">26</span><span class="token punctuation">)</span> <span class="token operator">|</span>day<span class="token operator">|</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> day_zig_file <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">fmt</span><span class="token punctuation">(</span><span class="token string">"src/days/day{d:0&gt;2}.zig"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>day<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create an executable for running this specific day.</span>
        <span class="token keyword">const</span> run_exe <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">addExecutable</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">{</span>
            <span class="token punctuation">.</span>name <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">fmt</span><span class="token punctuation">(</span><span class="token string">"run-day{d:0&gt;2}"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>day<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">.</span>root_source_file <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"src/run.zig"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">,</span>
            <span class="token punctuation">.</span>optimize <span class="token operator">=</span> optimize<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Inject the day-specific solution file as the anonymous module `day`.</span>
        run_exe<span class="token punctuation">.</span>root_module<span class="token punctuation">.</span><span class="token function">addAnonymousImport</span><span class="token punctuation">(</span><span class="token string">"day"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>root_source_file <span class="token operator">=</span> day_zig_file <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Install the executable so it can be run.</span>
        b<span class="token punctuation">.</span><span class="token function">installArtifact</span><span class="token punctuation">(</span>run_exe<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>My actual <code>build.zig</code> has some extra code that builds the binaries for all optimisation modes.</p>
<p>This setup is pretty barebones. I’ve seen <a href="https://github.com/fspoettel/advent-of-code-rust">other templates</a> do cool things like scaffold files, download puzzle inputs, and even submitting answers automatically. Since I wrote <code>build.zig</code> after the event ended, I didn’t get to use it when I was solving the puzzles. I might add more features to it if I decided to do Advent of Code again this year with Zig.</p>
<h2 id="self-imposed-constraints" tabindex="-1"><a class="header-anchor" href="#self-imposed-constraints">Self-Imposed Constraints</a></h2>
<p>While there are no rules to Advent of Code itself, to make things a little more interesting, I set a few constraints and rules for myself:</p>
<ol>
<li><strong>The code must be readable</strong>.
By “readable”, I mean the code should be straightforward and easy to follow. No unnecessary abstractions. I should be able to come back to the code months later and still understand (most of) it.</li>
<li><strong>Solutions must be a single file</strong>.
No external dependencies. No shared utilities module. Everything needed to solve the puzzle should be visible in that one solution file.</li>
<li><strong>The total runtime must be under one second</strong>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>
All solutions when run sequentially should finish in under one second. I want to improve my performance engineering skills.</li>
<li><strong>Parts should be solved separately</strong>.
This means: (1) no solving both parts simultaneously, and (2) no doing extra work in part one that make part two faster. The aim of this is to get a clear idea of how long each part takes on its own.</li>
<li><strong>No concurrency or parallelism</strong>.
Solutions must run sequentially on a single thread. This keeps the focus on the efficiency of the algorithm. I can’t speed up slow solutions by using multiple CPU cores.</li>
<li><strong>No ChatGPT. No Claude. No AI help</strong>.
I want to train myself, not the LLM. I can look at other people’s solutions, but only after I have given my best effort at solving the problem.</li>
<li><strong>Follow the constraints of the input file</strong>.
The solution doesn’t have to work for all possible scenarios, but it should work for all other inputs; if the input file only contains 8-bit unsigned integers, it doesn’t have to handle larger integer types.</li>
<li><strong>Hardcoding is allowed</strong>.
For example: size of the input, number of rows and columns, etc. Since the input is known at compile-time, we can skip runtime parsing and just embed it into the program using Zig’s <code>@embedFile</code>.</li>
</ol>
<p>Most of these constraints are designed to push me to write clearer, more performant code. I also wanted my code to look like it was taken straight from TigerBeetle’s codebase.<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> Lastly, I just thought it would make the experience more fun.</p>
<h2 id="favourite-puzzles" tabindex="-1"><a class="header-anchor" href="#favourite-puzzles">Favourite Puzzles</a></h2>
<p>From all of the puzzles, here are my top 3 favourites:</p>
<ol>
<li><strong>Day 6: Guard Gallivant</strong> - This is my slowest day (in benchmarks), but also the one I learned the most from. I’ve learned tricks while solving this day that helped me a lot in the rest of the event, e.g. using vectors to represent directions, padding 2D grids, metadata packing, system endianness, etc.</li>
<li><strong>Day 17: Chronospatial Computer</strong> - I love reverse engineering puzzles. I used to do a lot of these in CTFs during my university days. The best thing I learned from this puzzle is the realisation that we can use different integer bases to optimise data representation. This helped improve my runtimes in the later days 22 and 23.</li>
<li><strong>Day 21: Keypad Conundrum</strong> - This one was fun. My gut told me that it can be solved greedily by always choosing the best move. It was right. Though I did have to scroll Reddit for a bit to figure out the step I was missing, which was that you have to visit the farthest keypads first. This is also my longest solution (almost 400 lines) because I hardcoded the best-moves table.</li>
</ol>
<p>Some honourable mentions:</p>
<ol>
<li><strong>Day 24: Crossed Wires</strong> - Another reverse engineering puzzle. Confession: I didn’t solve this myself during the event. After 23 brutal days, my brain was too tired so I copied a random python solution from Reddit. When I retried it later, it turned out to be pretty fun. I still couldn’t find a solution I was satisfied with though.</li>
<li><strong>Day 11: Plutonian Pebbles</strong> - This day introduced me to the <a href="https://www.reddit.com/r/adventofcode/comments/1hn2osp/note_to_self_always_ask_is_this_lanternfish/">lanternfish algorithm</a> (memoization). Without this, my solution will probably never finish computing. It’s definitely a useful technique, as it’s also used in later days, but I don’t particularly like the puzzle itself.</li>
</ol>
<h2 id="programming-patterns-and-zig-tricks" tabindex="-1"><a class="header-anchor" href="#programming-patterns-and-zig-tricks">Programming patterns and Zig Tricks</a></h2>
<p>Throughout the event, I’ve learned a lot about Zig and performance, and also developed some personal coding conventions. Some of these are Zig-specific, but most are universal and can be applied across languages. This section covers general programming and Zig patterns I found useful. The next section will focus on performance-related tips.</p>
<h3 id="leverage-comptime" tabindex="-1"><a class="header-anchor" href="#leverage-comptime">Leverage Comptime</a></h3>
<p>Zig’s flagship feature, <a href="https://kristoff.it/blog/what-is-zig-comptime/"><code>comptime</code></a>, is surprisingly useful. I knew Zig uses it for generics and that people do clever metaprogramming with it, but I didn’t expect to be using it so often myself.</p>
<p>My main use for <code>comptime</code> was to generate puzzle-specific types. All of my solution files follow the same structure, with a <code>DayXX</code> function that takes some parameters (usually the input length) and returns a puzzle-specific type, e.g.:</p>
<div class="codeblock">
      <div>
        <span>src/days/day01.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">Day01</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> length<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">type</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> Self <span class="token operator">=</span> <span class="token builtin">@This</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        left<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token builtin-type keyword">u32</span></span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        right<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token builtin-type keyword">u32</span></span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>

        <span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span>Self</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This lets me instantiate the type with a size that matches my input:</p>
<div class="codeblock">
      <div>
        <span>src/days/day01.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token comment">// Here, `Day01` is called with the size of my actual input.</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">run</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>Allocator</span><span class="token punctuation">,</span> is_run<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">bool</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">!</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u64</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token builtin">@embedFile</span><span class="token punctuation">(</span><span class="token string">"./data/day01.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> puzzle <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">Day01</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Here, `Day01` is called with the size of my test input.</span>
<span class="token keyword">test</span> <span class="token string">"day 01 part 1 sample 1"</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> puzzle <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">Day01</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>sample_input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This allows me to reuse logic across different inputs while still hardcoding the array sizes. Without <code>comptime</code>, I have to either create a separate function for all my different inputs or dynamically allocate memory because I can’t hardcode the array size.</p>
<p>I also used <code>comptime</code> to shift some computation to compile-time to reduce runtime overhead. For example, in day 4, I needed a function to check whether a string matches either <code>"XMAS"</code> or its reverse, <code>"SAMX"</code>. A pretty simple function that you can write as a one-liner in Python:</p>
<div class="codeblock">
      <div>
        <span></span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">matches</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> target <span class="token operator">==</span> pattern <span class="token keyword">or</span> target <span class="token operator">==</span> pattern<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span></code></pre>
<p></p></div><p></p>
<p>Typically a function like this requires some dynamic allocation to create the reversed string, since the length of the string is only known at runtime.<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> For this puzzle, since the words to reverse are known at compile-time, we can do something like this:</p>
<div class="codeblock">
      <div>
        <span>src/days/day04.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">comptime</span> word<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> slice<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">u8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">bool</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reversed<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span>word<span class="token punctuation">.</span>len<span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token builtin">@memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>reversed<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>reversed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">eql</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> word<span class="token punctuation">,</span> slice<span class="token punctuation">)</span> <span class="token keyword">or</span> std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">eql</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>reversed<span class="token punctuation">,</span> slice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This creates a separate function for each word I want to reverse.<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup> Each function has an array with the same size as the word to reverse. This removes the need for dynamic allocation and makes the code run faster. As a bonus, Zig also warns you when this word isn’t compile-time known, so you get an immediate error if you pass in a runtime value.</p>
<h3 id="use-optional-types" tabindex="-1"><a class="header-anchor" href="#use-optional-types">Use Optional Types</a></h3>
<p>A common pattern in C is to return special sentinel values to denote missing values or errors, e.g. <code>-1</code>, <code>0</code>, or <code>NULL</code>. In fact, I did this on day 13 of the challenge:</p>
<div class="codeblock">
      <div>
        <span>src/days/day13.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token comment">// We won't ever get 0 as a result, so we use it as a sentinel error value.</span>
<span class="token keyword">fn</span> <span class="token function">count_tokens</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">i64</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">u64</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> numerator <span class="token operator">=</span> <span class="token builtin">@abs</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> denumerator <span class="token operator">=</span> <span class="token builtin">@abs</span><span class="token punctuation">(</span><span class="token builtin">@as</span><span class="token punctuation">(</span><span class="token builtin-type keyword">i32</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token builtin">@as</span><span class="token punctuation">(</span><span class="token builtin-type keyword">i32</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>numerator <span class="token operator">%</span> denumerator <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token keyword">else</span> numerator <span class="token operator">/</span> denumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Then in the caller, skip if the return value is 0.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count_tokens</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span></code></pre>
<p></p></div><p></p>
<p>This works, but it’s easy to forget to check for those values, or worse, to accidentally treat them as valid results. Zig improves on this with <a href="https://ziglang.org/documentation/master/#Optionals">optional types</a>. If a function might not return a value, you can return <code>?T</code> instead of <code>T</code>. This also forces the caller to handle the <code>null</code> case. Unlike C, <code>null</code> isn’t a pointer but a more general concept. Zig treats <code>null</code> as the absence of a value for any type, just like Rust’s <a href="https://doc.rust-lang.org/std/option/"><code>Option&lt;T&gt;</code></a>.</p>
<p>The <code>count_tokens</code> function can be refactored to:</p>
<div class="codeblock">
      <div>
        <span>src/days/day13.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token comment">// Return null instead if there's no valid result.</span>
<span class="token keyword">fn</span> <span class="token function">count_tokens</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">i64</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token operator">?</span><span class="token builtin-type keyword">u64</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> numerator <span class="token operator">=</span> <span class="token builtin">@abs</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> denumerator <span class="token operator">=</span> <span class="token builtin">@abs</span><span class="token punctuation">(</span><span class="token builtin">@as</span><span class="token punctuation">(</span><span class="token builtin-type keyword">i32</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token builtin">@as</span><span class="token punctuation">(</span><span class="token builtin-type keyword">i32</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>numerator <span class="token operator">%</span> denumerator <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">null</span> <span class="token keyword">else</span> numerator <span class="token operator">/</span> denumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// The caller is now forced to handle the null case.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count_tokens</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>n_tokens<span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token comment">// logic only runs when n_tokens is not null.</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>Zig also has a concept of <a href="https://ziglang.org/documentation/master/#Error-Union-Type">error unions</a>, where a function can return either a value or an error. In Rust, this is <a href="https://doc.rust-lang.org/std/result/"><code>Result&lt;T&gt;</code></a>. You could also use error unions instead of optionals for <code>count_tokens</code>, Zig doesn’t force a single approach. I come from Clojure where returning <code>nil</code> for an error or missing value is common.</p>
<h3 id="pad-your-2d-grids" tabindex="-1"><a class="header-anchor" href="#pad-your-2d-grids">Pad Your 2D Grids</a></h3>
<p>This year has a lot of 2D grid puzzles (arguably too many). A common feature of grid-based algorithms is the out-of-bounds check. Here’s how you would typically handle this:</p>
<div class="codeblock">
      <div>
        <span></span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">dfs</span><span class="token punctuation">(</span>map<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> position<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">i8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">u32</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x<span class="token punctuation">,</span> <span class="token keyword">const</span> y <span class="token operator">=</span> position<span class="token punctuation">;</span>
    
    <span class="token comment">// Bounds check here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> x <span class="token operator">&gt;=</span> map<span class="token punctuation">.</span>len <span class="token keyword">or</span> y <span class="token operator">&gt;=</span> map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">.</span>visited<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    map<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span>visited<span class="token punctuation">;</span>

    <span class="token keyword">var</span> result<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u32</span></span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>directions<span class="token punctuation">)</span> <span class="token operator">|</span> direction<span class="token operator">|</span> <span class="token punctuation">{</span>
        result <span class="token operator">+=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> position <span class="token operator">+</span> direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This is a typical recursive DFS structure. After doing a lot of this, I discovered a nice trick that not only improves code readability, but also its performance. The trick here is to pad the grid with sentinel characters that mark out-of-bounds areas, i.e. add a border to the grid.</p>
<p>Here’s an example of from day 6’:</p>
<pre class="language-plaintext"><code class="language-plaintext">Original map:               With borders added:
                            ************
....#.....                  *....#.....*
.........#                  *.........#*
..........                  *..........*
..#.......                  *..#.......*
.......#..        -&gt;        *.......#..*
..........                  *..........*
.#..^.....                  *.#..^.....*
........#.                  *........#.*
#.........                  *#.........*
......#...                  *......#...*
                            ************</code></pre>
<p>You can use any value as the border, as long as it doesn’t conflict with valid in-grid values. With the borders in place, the bounds check becomes a simple equality comparison:</p>
<div class="codeblock">
      <div>
        <span></span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">dfs</span><span class="token punctuation">(</span>map<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span></span><span class="token punctuation">,</span> position<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">i8</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">u32</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x<span class="token punctuation">,</span> <span class="token keyword">const</span> y <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// We are out of bounds</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This is much more readable than the previous code and is also faster since we’re only doing one comparison instead of four.</p>
<p>That said, this isn’t a one-size-fits-all solution. This only works for algorithms that traverse the grid one step at a time. If your logic jumps multiple tiles, it can still go out-of-bounds (except if you increase the width of your borders to account for this). This approach also uses a bit more memory than the regular approach as you have to store more characters.</p>
<h3 id="use-vectors-and-simd" tabindex="-1"><a class="header-anchor" href="#use-vectors-and-simd">Use Vectors and SIMD</a></h3>
<p>I guess this could also be in the performance tricks section, but I putting it here because the biggest benefit I get from using SIMD in Zig is code readability. Because Zig has first-class <a href="https://ziglang.org/documentation/master/#Vectors">support for vector types</a>, you can write elegant and readable code that also happens to be faster.</p>
<p>If you’re not familiar with vectors, they are a special collection type used for <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">Single instruction, multiple data (SIMD)</a> operations. SIMD allows you to perform computation on multiple values in parallel using only a single CPU instruction, which often leads to some performance boosts.<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></p>
<p>My biggest use for vectors is to represent positions and directions, e.g. for traversing a grid. Instead of writing code like this:</p>
<div class="codeblock">
      <div>
        <span></span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig">next_position <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">{</span> position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> direction<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> position<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> direction<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p></p></div><p></p>
<p>You can represent <code>position</code> and <code>direction</code> as 2-element vectors and write code like this:</p>
<div class="codeblock">
      <div>
        <span></span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig">next_position <span class="token operator">=</span> position <span class="token operator">+</span> direction<span class="token punctuation">;</span></code></pre>
<p></p></div><p></p>
<p>This is much nicer than the previous version!</p>
<p>Day 25 is another good example of a problem that can be solved elegantly using vectors:</p>
<div class="codeblock">
      <div>
        <span>src/days/day25.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">var</span> result<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">u64</span></span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>locks<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">|</span>lock<span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token comment">// lock is a vector</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">|</span>key<span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token comment">// key is also a vector</span>
        <span class="token keyword">const</span> fitted <span class="token operator">=</span> lock <span class="token operator">+</span> key <span class="token operator">&gt;</span> <span class="token builtin">@as</span><span class="token punctuation">(</span><span class="token builtin">@Vector</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token builtin-type keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">@splat</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> is_overlap <span class="token operator">=</span> <span class="token builtin">@reduce</span><span class="token punctuation">(</span><span class="token punctuation">.</span>Or<span class="token punctuation">,</span> fitted<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">+=</span> <span class="token builtin">@intFromBool</span><span class="token punctuation">(</span><span class="token operator">!</span>is_overlap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>Expressing the logic as vector operations makes the code cleaner since you don’t have to write loops and conditionals as you typically would in a traditional approach.</p>
<h2 id="performance-tips" tabindex="-1"><a class="header-anchor" href="#performance-tips">Performance Tips</a></h2>
<p>The tips below are general performance tricks that often help, but like most things in software engineering, “it depends”. These techniques might improve performance 80% of the time, but performance is often context-specific. You should benchmark your own code instead of blindly following what other people say.</p>
<p>This section would’ve been more fun with concrete examples, step-by-step optimisations, and benchmarks, but that would’ve made the post way too long. Hopefully I’ll get to write something like that in the future.<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup></p>
<h3 id="minimise-allocations" tabindex="-1"><a class="header-anchor" href="#minimise-allocations">Minimise Allocations</a></h3>
<p>Whenever possible, prefer static allocation. If you must use a heap allocator, allocate enough memory upfront. Dynamically allocating memory has more overhead from the allocator machinery vs stack allocation which just involves moving the stack pointer.</p>
<p>That said, static allocation isn’t always the right choice. Stack space is smaller than the heap, so allocating too much can cause a stack overflow. Repeated stack allocations, e.g. in tight loops, also has overhead, especially if the buffers are zeroed out each time.</p>
<p>A simple but effective trick I’ve learned is to reuse buffers whenever possible, whether they’re statically or dynamically allocated. Here’s an example from day 10. For each trail head, we want to create a set of trail ends reachable from it. The naive approach is to allocate a new set every iteration:</p>
<div class="codeblock">
      <div>
        <span>src/days/day10.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">for</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>trail_heads<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">|</span>trail_head<span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> trail_ends <span class="token operator">=</span> std<span class="token punctuation">.</span><span class="token function">AutoHashMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> <span class="token builtin-type keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>allocator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">defer</span> trail_ends<span class="token punctuation">.</span><span class="token function">deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Set building logic...</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>What you can do instead is to allocate the set once before the loop. Then, each iteration, you reuse the set by emptying it without freeing the memory. For Zig’s <code>std.AutoHashMap</code>, this can be done using the <code>clearRetainingCapacity</code> method:</p>
<div class="codeblock">
      <div>
        <span>src/days/day10.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">var</span> trail_ends <span class="token operator">=</span> std<span class="token punctuation">.</span><span class="token function">AutoHashMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> <span class="token builtin-type keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>allocator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">defer</span> trail_ends<span class="token punctuation">.</span><span class="token function">deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>trail_heads<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">|</span>trail_head<span class="token operator">|</span> <span class="token punctuation">{</span>
    trail_ends<span class="token punctuation">.</span><span class="token function">clearRetainingCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Set building logic...</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>Static allocation isn’t always faster than dynamic allocation. Sometimes dynamic allocation performs better. I’ve seen this in several of my solutions. Over-avoiding dynamic allocation can also result in convoluted, unreadable code that you’ll likely forget how it works after a few days. Remember to always benchmark your code to understand what works best for your specific case.</p>
<h3 id="compact-your-data" tabindex="-1"><a class="header-anchor" href="#compact-your-data">Compact Your Data</a></h3>
<p>A performance tip people often say is to have “mechanical empathy”. Avoid leaving CPU cache, prefer arrays over linked-lists because of cache locality, etc. These are good tips, but how do you apply this in practice?</p>
<p>A simple approach is to reduce the size of your data. Smaller data means more of it can fit in cache, which improves <a href="https://stackoverflow.com/a/7812002/950912">spatial locality</a> and speeds up access.</p>
<p>One way to do this is <a href="https://www.cs.cornell.edu/courses/cs3410/2024fa/notes/bitpack.html">bit packing</a>. This depends heavily on your specific data, so you’ll need to use your own judgement to tell whether this would work for you. I’ll just share an example that worked for me on day 6.</p>
<p>In day 6 part two, you have to detect a loop, which happens when you revisit a tile from the same direction as before. To track this, you could use a map or a set to store the tiles and visited directions. A more efficient option is to store this direction metadata in the tile itself.</p>
<p>There are only four tile types, which means you only need two bits to represent the tile types as an enum. If the enum size is one byte, here’s what the tiles looks like in memory:</p>
<pre class="language-plaintext"><code class="language-plaintext">.obstacle -&gt; 00000000
.path     -&gt; 00000001
.visited  -&gt; 00000010
.path     -&gt; 00000011</code></pre>
<p>As you can see, the upper six bits are unused. We can store the direction metadata in the upper four bits. One bit for each direction. If a bit is set, it means that we’ve already visited the tile in this direction. Here’s an illustration of the memory layout:</p>
<pre class="language-plaintext"><code class="language-plaintext">        direction metadata   tile type
           ┌─────┴─────┐   ┌─────┴─────┐
┌────────┬─┴─┬───┬───┬─┴─┬─┴─┬───┬───┬─┴─┐
│ Tile:  │ 1 │ 0 │ 0 │ 0 │ 0 │ 0 │ 1 │ 0 │
└────────┴─┬─┴─┬─┴─┬─┴─┬─┴───┴───┴───┴───┘
   up bit ─┘   │   │   └─ left bit
    right bit ─┘ down bit</code></pre>
<p>If your language supports struct packing, you can express this layout directly:<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup></p>
<div class="codeblock">
      <div>
        <span>src/days/day06.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">const</span> <span class="token class-name">Tile</span> <span class="token operator">=</span> <span class="token keyword">packed</span> <span class="token keyword">struct</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    up<span class="token punctuation">:</span> <span class="token class-name">u1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    right<span class="token punctuation">:</span> <span class="token class-name">u1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    down<span class="token punctuation">:</span> <span class="token class-name">u1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    left<span class="token punctuation">:</span> <span class="token class-name">u1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    tile<span class="token punctuation">:</span> <span class="token keyword">enum</span><span class="token punctuation">(</span>u4<span class="token punctuation">)</span> <span class="token punctuation">{</span> obstacle<span class="token punctuation">,</span> path<span class="token punctuation">,</span> visited<span class="token punctuation">,</span> exit <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>Doing this avoids extra allocations and improves cache locality. Since the directions metadata is colocated with the tile type, all of them can fit together in cache. Accessing the directions just requires some bitwise operations instead of having to fetch it from another region of memory.</p>
<p>Another way to do this is to represent your data using <a href="https://en.wikipedia.org/wiki/Numeral_system#Positional_systems_in_detail">alternate number bases</a>. Here’s an example from day 23. Computers are represented as two character strings made up of only lowercase letters, e.g. <code>"bc"</code>, <code>"xy"</code>, etc. Instead of storing this as a <code>[2]u8</code> array, you can convert it into a base-26 number and store it as a <code>u16</code>.<sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup></p>
<p>Here’s the idea: map <code>'a'</code> to 0, <code>'b'</code> to 1, up to <code>'z'</code> as 25. Each character in the string becomes a digit in the base-26 number. For example,  <code>"bc"</code> ( <code>[2]u8{ 'b', 'c' }</code>) becomes the base-10 number 28 (<mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="14.33ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 6334 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-TEX-N-31"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="D7" xlink:href="#MJX-TEX-I-D7"></use></g><g data-mml-node="mn" transform="translate(1278,0)"><use data-c="32" xlink:href="#MJX-TEX-N-32"></use><use data-c="36" xlink:href="#MJX-TEX-N-36" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(2500.2,0)"><use data-c="2B" xlink:href="#MJX-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(3500.4,0)"><use data-c="32" xlink:href="#MJX-TEX-N-32"></use></g><g data-mml-node="mo" transform="translate(4278.2,0)"><use data-c="3D" xlink:href="#MJX-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(5334,0)"><use data-c="32" xlink:href="#MJX-TEX-N-32"></use><use data-c="38" xlink:href="#MJX-TEX-N-38" transform="translate(500,0)"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mi>×</mi><mn>26</mn><mo>+</mo><mn>2</mn><mo>=</mo><mn>28</mn></math></mjx-assistive-mml></mjx-container>). If we represent this using the base-64 character set, it becomes 12 (<code>'b'</code> = 1, <code>'c'</code> = 2).</p>
<p>While they take the same amount of space (2 bytes), a <code>u16</code> has some benefits over a <code>[2]u8</code>:</p>
<ol>
<li>It fits in a single register whereas you need two for an the array.</li>
<li>Comparison is faster as there is only a single value to compare.</li>
</ol>
<h3 id="reduce-branching" tabindex="-1"><a class="header-anchor" href="#reduce-branching">Reduce Branching</a></h3>
<p>I won’t explain branchless programming here, instead read <a href="https://en.algorithmica.org/hpc/pipelining/branchless/">the Algorithmica’s page</a> which explains it way better than I can. While modern compilers are smart enough to compile away branches, they don’t catch everything. I still recommend writing branchless code whenever it makes sense. It also has the added benefit of reducing the number of <a href="https://www.rfleury.com/p/the-codepath-combinatoric-explosion">codepaths in your program</a>.</p>
<p>Again, since performance is always context-dependent, I’ll just show you some patterns I use. Here’s one that comes up often:</p>
<div class="codeblock">
      <div>
        <span>src/days/day02.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_valid_report</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>Instead of the branch, cast the bool into an integer directly:</p>
<div class="codeblock">
      <div>
        <span>src/days/day02.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig">result <span class="token operator">+=</span> <span class="token builtin">@intFromBool</span><span class="token punctuation">(</span><span class="token function">is_valid_report</span><span class="token punctuation">(</span>report<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p></p></div><p></p>
<p>Another example is from day 6 (again!). Recall that to know if a tile has been visited from a certain direction, we have to check its direction bit. Here’s one way to do it:</p>
<div class="codeblock">
      <div>
        <span>src/days/day06.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">has_visited</span><span class="token punctuation">(</span>self<span class="token punctuation">:</span> <span class="token class-name">Tile</span><span class="token punctuation">,</span> direction<span class="token punctuation">:</span> <span class="token class-name">Direction</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">bool</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span>up <span class="token operator">=&gt;</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>up <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span>right <span class="token operator">=&gt;</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>right <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span>down <span class="token operator">=&gt;</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>down <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span>left <span class="token operator">=&gt;</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>This works, but it introduces a branch. We can make it branchless using bitwise operations:</p>
<div class="codeblock">
      <div>
        <span>src/days/day06.zig</span>
        <button onclick="copy(this)">Copy</button>
      </div>
<pre class="language-zig"><code class="language-zig"><span class="token keyword">fn</span> <span class="token function">has_visited</span><span class="token punctuation">(</span>tile<span class="token punctuation">:</span> <span class="token class-name">Tile</span><span class="token punctuation">,</span> direction<span class="token punctuation">:</span> <span class="token class-name">Direction</span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">bool</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> int_tile <span class="token operator">=</span> std<span class="token punctuation">.</span>mem<span class="token punctuation">.</span><span class="token function">nativeToBig</span><span class="token punctuation">(</span><span class="token builtin-type keyword">u8</span><span class="token punctuation">,</span> <span class="token builtin">@bitCast</span><span class="token punctuation">(</span>tile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> mask <span class="token operator">=</span> direction<span class="token punctuation">.</span><span class="token function">mask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bits <span class="token operator">=</span> int_tile <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span> <span class="token comment">// Get only the direction bits</span>
    <span class="token keyword">return</span> bits <span class="token operator">&amp;</span> mask <span class="token operator">==</span> mask<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p></p></div><p></p>
<p>While this is arguably cryptic and less readable, but it does perform better than the switch version.</p>
<h3 id="avoid-recursion" tabindex="-1"><a class="header-anchor" href="#avoid-recursion">Avoid Recursion</a></h3>
<p>The final performance tip is to prefer iterative code over recursion. Recursive functions brings the overhead allocating a new stack frames. While recursive code is more elegant, it’s also often slower unless your language’s compiler can optimise it away, e.g. via tail-call optimisation. As far as I know, Zig doesn’t have this, though I might be wrong.</p>
<p>Recursion also has the risk of causing a stack overflow if the execution isn’t bounded. This is why code that are mission- or safety-critical avoid recursion entirely. It’s in TigerBeetle’s <a href="https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/TIGER_STYLE.md">TIGERSTYLE</a> and also NASA’s <a href="https://spinroot.com/gerard/pdf/P10.pdf">Power of Ten</a>.</p>
<p>While iterative code can be harder to write in some cases, e.g. DFS maps naturally to recursion, but in almost all cases iterative code is significantly faster and more predictable than the recursive alternative.</p>
<h2 id="benchmarks" tabindex="-1"><a class="header-anchor" href="#benchmarks">Benchmarks</a></h2>
<p>I ran benchmarks for all 25 solutions in each of Zig’s optimisation modes. You can find the full results and the benchmark script in my <a href="https://github.com/rmrt1n/advent-of-code">GitHub repository</a>. All benchmarks were done on an <a href="https://en.wikipedia.org/wiki/Apple_M3">Apple M3 Pro</a>.</p>
<p>As expected, <code>ReleaseFast</code> produced the best result with a total runtime of <strong>85.1 ms</strong>. I’m quite happy with this, considering the two constraints that limited the number of optimisations I can do to the code:</p>
<ul>
<li><strong>Parts should be solved separately</strong> - Some days can be solved in a single go, e.g. day 10 and day 13, which could’ve saved a few milliseconds.</li>
<li><strong>No concurrency or parallelism</strong> - My slowest days are the compute-heavy days that are very easily parallelisable, e.g. day 6, day 19, and day 22. Without this constraint I can probably reach sub-20 milliseconds(?), but that’s for another time.</li>
</ul>
<p>You can see the full benchmarks for <code>ReleaseFast</code> in the table below:</p>
<div style="overflow-x: auto">
<table>
<thead>
<tr>
<th>Day</th>
<th>Title</th>
<th style="text-align:right">Parsing (µs)</th>
<th style="text-align:right">Part 1 (µs)</th>
<th style="text-align:right">Part 2 (µs)</th>
<th style="text-align:right">Total (µs)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Historian Hysteria</td>
<td style="text-align:right">23.5</td>
<td style="text-align:right">15.5</td>
<td style="text-align:right">2.8</td>
<td style="text-align:right"><strong>41.8</strong></td>
</tr>
<tr>
<td>2</td>
<td>Red-Nosed Reports</td>
<td style="text-align:right">42.9</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11.5</td>
<td style="text-align:right"><strong>54.4</strong></td>
</tr>
<tr>
<td>3</td>
<td>Mull it Over</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">7.2</td>
<td style="text-align:right">16.0</td>
<td style="text-align:right"><strong>23.2</strong></td>
</tr>
<tr>
<td>4</td>
<td>Ceres Search</td>
<td style="text-align:right">5.9</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right"><strong>5.9</strong></td>
</tr>
<tr>
<td>5</td>
<td>Print Queue</td>
<td style="text-align:right">22.3</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">4.6</td>
<td style="text-align:right"><strong>26.9</strong></td>
</tr>
<tr>
<td>6</td>
<td>Guard Gallivant</td>
<td style="text-align:right">14.0</td>
<td style="text-align:right">25.2</td>
<td style="text-align:right">24,331.5</td>
<td style="text-align:right"><strong>24,370.7</strong></td>
</tr>
<tr>
<td>7</td>
<td>Bridge Repair</td>
<td style="text-align:right">72.6</td>
<td style="text-align:right">321.4</td>
<td style="text-align:right">9,620.7</td>
<td style="text-align:right"><strong>10,014.7</strong></td>
</tr>
<tr>
<td>8</td>
<td>Resonant Collinearity</td>
<td style="text-align:right">2.7</td>
<td style="text-align:right">3.3</td>
<td style="text-align:right">13.4</td>
<td style="text-align:right"><strong>19.4</strong></td>
</tr>
<tr>
<td>9</td>
<td>Disk Fragmenter</td>
<td style="text-align:right">0.8</td>
<td style="text-align:right">12.9</td>
<td style="text-align:right">137.9</td>
<td style="text-align:right"><strong>151.7</strong></td>
</tr>
<tr>
<td>10</td>
<td>Hoof It</td>
<td style="text-align:right">2.2</td>
<td style="text-align:right">29.9</td>
<td style="text-align:right">27.8</td>
<td style="text-align:right"><strong>59.9</strong></td>
</tr>
<tr>
<td>11</td>
<td>Plutonian Pebbles</td>
<td style="text-align:right">0.1</td>
<td style="text-align:right">43.8</td>
<td style="text-align:right">2,115.2</td>
<td style="text-align:right"><strong>2,159.1</strong></td>
</tr>
<tr>
<td>12</td>
<td>Garden Groups</td>
<td style="text-align:right">6.8</td>
<td style="text-align:right">164.4</td>
<td style="text-align:right">249.0</td>
<td style="text-align:right"><strong>420.3</strong></td>
</tr>
<tr>
<td>13</td>
<td>Claw Contraption</td>
<td style="text-align:right">14.7</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right"><strong>14.7</strong></td>
</tr>
<tr>
<td>14</td>
<td>Restroom Redoubt</td>
<td style="text-align:right">13.7</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right"><strong>13.7</strong></td>
</tr>
<tr>
<td>15</td>
<td>Warehouse Woes</td>
<td style="text-align:right">14.6</td>
<td style="text-align:right">228.5</td>
<td style="text-align:right">458.3</td>
<td style="text-align:right"><strong>701.5</strong></td>
</tr>
<tr>
<td>16</td>
<td>Reindeer Maze</td>
<td style="text-align:right">12.6</td>
<td style="text-align:right">2,480.8</td>
<td style="text-align:right">9,010.7</td>
<td style="text-align:right"><strong>11,504.1</strong></td>
</tr>
<tr>
<td>17</td>
<td>Chronospatial Computer</td>
<td style="text-align:right">0.1</td>
<td style="text-align:right">0.2</td>
<td style="text-align:right">44.5</td>
<td style="text-align:right"><strong>44.8</strong></td>
</tr>
<tr>
<td>18</td>
<td>RAM Run</td>
<td style="text-align:right">35.6</td>
<td style="text-align:right">15.8</td>
<td style="text-align:right">33.8</td>
<td style="text-align:right"><strong>85.2</strong></td>
</tr>
<tr>
<td>19</td>
<td>Linen Layout</td>
<td style="text-align:right">10.7</td>
<td style="text-align:right">11,890.8</td>
<td style="text-align:right">11,908.7</td>
<td style="text-align:right"><strong>23,810.2</strong></td>
</tr>
<tr>
<td>20</td>
<td>Race Condition</td>
<td style="text-align:right">48.7</td>
<td style="text-align:right">54.5</td>
<td style="text-align:right">54.2</td>
<td style="text-align:right"><strong>157.4</strong></td>
</tr>
<tr>
<td>21</td>
<td>Keypad Conundrum</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">1.7</td>
<td style="text-align:right">22.4</td>
<td style="text-align:right"><strong>24.2</strong></td>
</tr>
<tr>
<td>22</td>
<td>Monkey Market</td>
<td style="text-align:right">20.7</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">11,227.7</td>
<td style="text-align:right"><strong>11,248.4</strong></td>
</tr>
<tr>
<td>23</td>
<td>LAN Party</td>
<td style="text-align:right">13.6</td>
<td style="text-align:right">22.0</td>
<td style="text-align:right">2.5</td>
<td style="text-align:right"><strong>38.2</strong></td>
</tr>
<tr>
<td>24</td>
<td>Crossed Wires</td>
<td style="text-align:right">5.0</td>
<td style="text-align:right">41.3</td>
<td style="text-align:right">14.3</td>
<td style="text-align:right"><strong>60.7</strong></td>
</tr>
<tr>
<td>25</td>
<td>Code Chronicle</td>
<td style="text-align:right">24.9</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right">0.0</td>
<td style="text-align:right"><strong>24.9</strong></td>
</tr>
</tbody>
</table>
</div>
<p>A weird thing I found when benchmarking is that for day 6 part two, <code>ReleaseSafe</code> actually ran faster than <code>ReleaseFast</code> (13,189.0 µs vs 24,370.7 µs). Their outputs are the same, but for some reason <code>ReleaseSafe</code> is faster even with the safety checks still intact.</p>
<p>The Zig compiler is still very much a moving target, so I don’t want to dig too deep into this as this is probably a bug in the compiler. This weird behaviour might just disappear after a few compiler version updates.</p>
<h2 id="reflections" tabindex="-1"><a class="header-anchor" href="#reflections">Reflections</a></h2>
<p>Looking back, I’m really glad I decided to do Advent of Code and followed through to the end. I learned a lot of things. Some are useful in my professional work, some are more like random bits of trivia. Going with Zig was a good choice too. The language is small, simple, and gets out of your way. I learned more about algorithms and concepts than the language itself.</p>
<p>Besides what I’ve already mentioned earlier, here are some examples of the things I learned:</p>
<ul>
<li>The concept of <a href="https://en.wikipedia.org/wiki/Taxicab_geometry">Manhattan distance</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm">Cliques</a> and the <a href="https://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm">Bron-Kerbosch algorithm</a>.</li>
<li>The <a href="https://en.wikipedia.org/wiki/Adder_(electronics)#Ripple-carry_adder">ripple-carry adder circuit</a>.</li>
<li>LaTeX math syntax with <a href="https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/writing-mathematical-expressions">MathJax</a>, which I used in my write-ups.</li>
<li>In Python you can use <a href="https://www.alpinewerk.com/posts/complex/">complex numbers to traverse 2D grids</a>!</li>
</ul>
<p>Some of my self-imposed constraints and rules ended up being helpful. I can still (mostly) understand the code I wrote a few months ago. Putting all of the code in a single file made it easier to read since I don’t have to context switch to other files all the time.</p>
<p>However, some of them did backfire a bit, e.g. the two constraints that limit how I can optimise my code. Another one is the “hardcoding allowed” rule. I used a lot of magic numbers, which helped to improve performance, but I didn’t document them so after a while I don’t even know how I got them. I’ve since gone back and added explanations in my write-ups, but next time I’ll remember to at least leave a comment.</p>
<p>One constraint I’ll probably remove next time is the no concurrency rule. It’s the biggest contributor to the total runtime of my solutions. I don’t do a lot of concurrent programming, even though my main language at work is Go, so next time it might be a good idea to use Advent of Code to level up my concurrency skills.</p>
<p>I also spent way more time on these puzzles than I originally expected. I optimised and rewrote my code multiple times. I also rewrote my write-ups a few times to make them easier to read. This is by far my longest side project yet. It’s a lot of fun, but it also takes a lot of time and effort to do. I almost gave up on the write-ups (and this blog post) because I don’t want to explain my awful day 15 and day 16 code. I ended up taking a break for a few months before finishing it, which is why this post was published on August lol.</p>
<p>Just for fun here’s a photo of some of my notebook sketches that helped me visualise my solutions. See if you can guess which days these are from:</p>
<p><img loading="lazy" decoding="async" src="/drafts/f7abb9dbf8f2d0545d2385e7e65af7a2/hWE070SOvc-1600.webp" alt="" width="1600" height="1600"></p>
<h2 id="what%E2%80%99s-next%3F" tabindex="-1"><a class="header-anchor" href="#what%E2%80%99s-next%3F">What’s Next?</a></h2>
<p>So… would I do it again? Probably, though I’m not making any promises. If I do join this year, I’ll probably stick with Zig. I had my eyes on Zig since the start of 2024, so Advent of Code was the perfect excuse to learn it. This year, there aren’t any languages in particular that caught my eye, so I’ll just keep using Zig, especially since I have a proper setup ready.</p>
<p>If you haven’t tried Advent of Code, I highly recommend checking it out this year. It’s a great excuse to learn a new language, improve your problem solving skills, or just to learn something new. If you’re really eager, you can also do the <a href="https://adventofcode.com/2024/events">previous years’ puzzles</a> as they’re still available.</p>
<p>One of the best aspects of Advent of Code is the community. The <a href="https://adventofcode.com/2024/events">Advent of Code subreddit</a> is a great place for discussion. You can ask questions and also see other people’s solutions. Some people also post really cool visualisations like <a href="https://www.reddit.com/r/adventofcode/s/nylBX7xFbp">this one</a>. They also have <a href="https://www.reddit.com/r/adventofcode/?f=flair_name%3A%22Meme%2FFunny%22">memes!</a></p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>I failed my first attempt horribly with <a href="https://clojure.org/">Clojure</a> during Advent of Code 2023. Once I reached the later half of the event I just couldn’t solve the problems with a purely functional style. I could’ve pushed through using imperative code, but I stubbornly chose not to and gave up… <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>The original constraint was each solution must run in under one second. As it turned out, the code was faster than I expected, so I increased the difficulty. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p>TigerBeetle’s code quality and <a href="https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/TIGER_STYLE.md">engineering principles</a> are just wonderful. <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn4" class="footnote-item"><p>You can implement this function without any allocation by mutating the string in place or by iterating over it twice, which is probably faster than my current implementation. I kept it as-is as a reminder of what <code>comptime</code> can do. <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn5" class="footnote-item"><p>As a bonus, I was curious as to how this looks like compiled so I listed all the functions in this binary in GDB and found:</p>
<pre class="language-plaintext"><code class="language-plaintext">72:     static bool day04.Day04(140).matches__anon_19741;
72:     static bool day04.Day04(140).matches__anon_19750;</code></pre>
<p>It does generate separate functions! <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Well, not always. The number of SIMD instructions depend on the machine’s native SIMD size. If the length of the vector exceeds it, Zig will compile it into multiple SIMD instructions. <a href="#fnref6" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn7" class="footnote-item"><p>Here’s a nice <a href="https://cprimozic.net/blog/optimizing-advent-of-code-2024/">post on optimising day 9’s solution with Rust</a>. It’s a good read if you’re into performance engineering or Rust techniques. <a href="#fnref7" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn8" class="footnote-item"><p>One thing about packed structs is that their layout is dependent on the system endianness. Most modern systems are little-endian, so the memory layout I showed is actually reversed. Thankfully Zig has some useful functions to convert between endianness like <code>std.mem.nativeToBig</code>, which makes working with packed structs easier. <a href="#fnref8" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn9" class="footnote-item"><p>Technically you can store 2-digit base 26 numbers in a <code>u10</code>, as there are only <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="3.25ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 1436.6 886" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-TEX-N-32"></use><use data-c="36" xlink:href="#MJX-TEX-N-36" transform="translate(500,0)"></use></g><g data-mml-node="mn" transform="translate(1033,393.1) scale(0.707)"><use data-c="32" xlink:href="#MJX-TEX-N-32"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>26</mn><mn>2</mn></msup></math></mjx-assistive-mml></mjx-container> possible numbers. Most systems usually pad values by byte size, so <code>u10</code> will still be stored as <code>u16</code>, which is why I just went straight for it. <a href="#fnref9" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

  </section>
  
</article>

    </main>
    <footer>
      <div>
        <small>© 2024-2025 Ryan Martin - CC BY-NC-SA 4.0</small>
        <small><a href="#top">Back to top ⤴</a></small>
      </div>
      <small>
        <a href="/feed.xml">
          Subscribe via RSS
          <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" style="height: 1.2em; width: 1.2em; vertical-align: text-bottom" viewBox="0 0 256 256">
            <circle cx="68" cy="189" r="24" fill="currentColor"></circle>
            <path d="M160 213h-34a82 82 0 0 0 -82 -82v-34a116 116 0 0 1 116 116z" fill="currentColor"></path>
            <path d="M184 213A140 140 0 0 0 44 73 V 38a175 175 0 0 1 175 175z" fill="currentColor"></path>
          </svg>
          </a>
      </small>
      <small><a href="/colophon/">Colophon</a></small>
    </footer>
  <svg style="display: none;" id="MJX-SVG-global-cache"><defs><path id="MJX-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-TEX-I-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs></svg></body>
</html>
